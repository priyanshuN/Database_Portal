<html>
    <head>
        <title>Project/Publication upload portal</title>
        <!-- Required meta tags always come first -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        
        <link rel="stylesheet" type="text/css" href="../css/style.css">
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js">
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
    </head>
    <!--body>
        <div class="container" id="wrap">
            <div class="form-group">
                <label for='check_box'>Check the boxes for your search</label>
                <div class="custom-control custom-check_box" id="checkbox1">
                    <input type="checkbox" class="custom-control-input" id="check1">
                    <label class="custom-control-label" for="check1">Name</label>
                </div>
                <div class="custom-control custom-check_box" id="checkbox2">
                    <input type="checkbox" class="custom-control-input" id="check2">
                    <label class="custom-control-label" for="check2">Type</label>
                </div>
                    <input type="checkbox" class="custom-control-input" id="check3">
                    <label class="custom-control-label" for="check3">Year</label>
                    <input type="checkbox" class="custom-control-input" id="check4">
                    <label class="custom-control-label" for="check4">Budget</label>
                    <input type="checkbox" class="custom-control-input" id="check5">
                    <label class="custom-control-label" for="check5">Name</label>
                    <input type="checkbox" class="custom-control-input" id="check6">
                    <label class="custom-control-label" for="check6">Name</label>
                </div>
            </div>
        </div>
    </body-->
    <body>
        <!--div class="container" id="wrap">
            <div class="custom-control custom-check_box">
                <input type="checkbox" class="custom-control-input" id="check1">
                <label class="custom-control-label" for="check1">Name</label>
            </div>
            <div class="custom-control custom-check_box">
                <input type="checkbox" class="custom-control-input" id="check2">
                <label class="custom-control-label" for="check2">Type</label>
            </div>
            <div class="custom-control custom-check_box">
                <input type="checkbox" class="custom-control-input" id="check4">
                <label class="custom-control-label" for="check4">Budget</label>
            </div>
            <div class="custom-control custom-check_box">
                <input type="checkbox" class="custom-control-input" id="check5">
                <label class="custom-control-label" for="check5">Year</label>
            </div>
        </div-->
        <div class="container" id ="wrap">
            <input type="checkbox" id="c1">Name
            <input type="checkbox" id="c2">Paper
            <input type="checkbox" id="c3">Journal
            <input type="checkbox" id="c4">Project
            <input type="checkbox" id="c5">Year
            <input type="checkbox" id="c6">Budget
        </div>
        <div class="container" id="wrap">
            <div class="form-group" style="display:none;" id="dname">
                <label for="name">Name</label>
                <input class="form-control" id="name" name="name" type="text" placeholder="Submission name">
            </div>
            <div class="form-group" style="display:none;" id="dyear">
                <label for="year">Year</label>
                <input class="form-control" id="year" name="year" type="text" placeholder="eg. 2008">
            </div>
            <div class="form-group" id="dbudg" style="display: none;" >
                <label for="budget">Budget</label>
                <input class="form-control" id="budget" name="budget" type="number" placeholder="eg. 200520">
                <p>Want to specify range</p>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="ll">Lower range</label>
                        <input type="number" id="ll" class="form-control">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="ul">Upper range</label>
                        <input type="number" id="ul" class="form-control">
                    </div>
                </div>
            </div>
            <button type="submit" class="btn btn-secondary" id="csubmit">Submit</button>
            <div id="srec" style="display:none;"></div>
        </div>
        <div id="chart-container">
            <canvas id="graphCanvas"></canvas>
        </div>
        <script type="text/javascript">

            $(function(){
                $('#c1').change(function(){
                    var c1=$('#c1').prop('checked');
                    if(c1){
                        $('#dname').show();
                    }
                    else{
                        $('#dname').hide();
                    }
                });
                $('#c5').change(function(){
                    var c5=$('#c5').prop('checked');
                    if(c5){
                        $('#dyear').show();
                    }
                    else{
                        $('#dyear').hide();
                    }
                });
                 /*$('#c4').change(function(){
                    var c4=$('#c4').prop('checked');
                    if(c4){
                        $('#db').show();
                    }
                    else{
                        $('#db').hide();
                    }
                });*/
                $('#c6').change(function(){
                    var c6=$('#c6').prop('checked');
                    if(c6){
                        $('#dbudg').show();
                    }
                    else{
                        $('#dbudg').hide();
                    }
                });
                $('#csubmit').click(function(){
                    var c1=$('#c1').prop('checked');
                    var c2=$('#c2').prop('checked');
                    var c3=$('#c3').prop('checked');
                    var c4=$('#c4').prop('checked');
                    var c5=$('#c5').prop('checked');
                    var c6=$('#c6').prop('checked');
                    
                    if(c1 || c2 || c3 || c4 || c5 || c6){
                        $('#submitAlert').html("Success");
                        $('#submitAlert').show();
                    }
                    else{
                         $('#submitAlert').html("Please check one of the box");
                        $('#submitAlert').show();
                    }
                });
                $('#csubmit').click(function(){
                    var na,pa,jo,pr,ye,bu,lo,up;
                    var c1=$('#c1').prop('checked');
                    var c2=$('#c2').prop('checked');
                    var c3=$('#c3').prop('checked');
                    var c4=$('#c4').prop('checked');
                    var c5=$('#c5').prop('checked');
                    var c6=$('#c6').prop('checked');
                    if(c1){
                        na=$('#name').val();
                    }
                    else{
                        na="";
                    }
                    if(c2){
                        pa='paper';
                    }
                    else{
                        pa="";
                    }
                    if(c3){
                        jo='journal';
                    }
                    else{
                        jo="";
                    }
                    if(c4){
                        pr='project';
                    }
                    else{
                        pr="";
                    }
                    if(c5){
                        ye =$('#year').val();
                    }
                    else{
                        ye="";
                    }
                    if(c6){
                        bu=$('#budget').val();
                        lo=$('#ll').val();
                        up=$('#ul').val();
                        if($('#budget').val()=="")
                            bu=-1;
                        if(lo=="")
                            lo=-1;
                        if(up=="")
                            up=-1;
                    }
                    else{
                        bu=-1;
                        lo=-1;
                        up=-1;
                    }
                    /*if($('#budget').val()=="")
                        console.log(1);
                        console.log($('#budget').val());*/
                    $.ajax({
                       type:'POST',
                        url:'../php/search_d.php/?action=search',
                        data:{
                            name:na,
                            paper:pa,
                            journal:jo,
                            project:pr,
                            year:ye,
                            budget:bu,
                            lower:lo,
                            upper:up
                        }
                    })
                    .done(function(result){
                        if(result!=""){
                            $('#srec').html(result);
                            $('#srec').show();
                        }
                        else{
                           $('#srec').html("No records for the query");
                        }
                    })
                    .fail(function(xhr,status,error){
                        var err=xhr.status + ': ' + xhr.statusText;
                        alert('Error : '+err);
                    })
                    $.ajax({
                       type:'POST',
                        url:'../php/chart.php/?action=chart',
                        data:{
                            name:na,
                            paper:pa,
                            journal:jo,
                            project:pr,
                            year:ye,
                            budget:bu,
                            lower:lo,
                            upper:up
                        }
                    })
                    .done(function(data){
                        console.log(data);
                        var name = [];
                        var marks = [];
                        var data1=JSON.parse(data);
                        console.log(data);
                         for (var i=0;i<data1.length;++i) {
                            name.push(data1[i]['Name']);
                            marks.push(data1[i]['YearofPub']);
                        }
                        console.log(name);
                        console.log(marks);
                        var chartdata = {
                            labels: name,
                            datasets: [
                                {
                                    label: 'Student Marks',
                                    backgroundColor: '#49e2ff',
                                    borderColor: '#46d5f1',
                                    hoverBackgroundColor: '#CCCCCC',
                                    hoverBorderColor: '#666666',
                                    data: marks
                                }
                            ]
                        };

                        var graphTarget = $("#graphCanvas");

                        var barGraph = new Chart(graphTarget, {
                            type: 'bar',
                            data: chartdata
                        });
                    })
                    .fail(function(xhr,status,error){
                        var err=xhr.status + ': ' + xhr.statusText;
                        alert('Error : '+err);
                    })
                });
            });
        </script>
    </body>
</html>